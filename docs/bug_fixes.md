# 🐛 Bug Fixes (오류 수정 내용)

이 문서는 개발 과정에서 발견된 버그와 그 수정 내용을 기록합니다.

---

## 📅 2025-12-31

### 1. 배포 빌드 에러 수정 (StepAnalysis.tsx)
- **문제**: `vite build` 실행 시 TypeScript 컴파일 에러가 발생하여 배포 빌드가 실패함.
- **원인**: `StepAnalysis.tsx` 내에서 닫히지 않은 JSX 태그 또는 잘못 중첩된 괄호가 존재했음.
- **수정**: 문법 오류가 있는 라인을 찾아 JSX 구조를 올바르게 수정함.

### 2. 콜라주 생성 로직 및 프롬프트 버그
- **문제**: `collage-2x2` 레이아웃을 요청했음에도 불구하고 AI가 `1-2` 형태로 이미지를 생성하는 빈도가 높았음.
- **원인**: 프롬프트에서 레이아웃 지시 사항이 충분히 구체적이지 않았고, 모델이 기본 학습된 구도를 선호하는 경향이 있었음.
- **수정**: `GEMINI.md`의 콜라주 가이드를 참고하여, 각 콜라주 타입에 대해 기하학적 구조(Grid, Percentage)를 명시적으로 강제하는 프롬프트(User Prompt Enforcement)를 적용함.

### 3. 미니맵 레이아웃 배지 표시 오류
- **문제**: 미니맵에서 모든 비그리드 섹션이 "전체"로만 표시됨.
- **원인**: `SectionMiniMap.tsx`의 `getBadgeInfo` 함수에서 `layoutType`에 대한 상세 케이스 처리가 부족했음.
- **수정**: `text-only`, `split-left`, `split-right` 등 각 레이아웃 타입별 케이스를 추가하고, 콜라주 레이아웃(`collage-*`)에 대한 보라색 배지 처리를 추가함.

---

## 📅 2025-12-30

### 1. 마네킹/얼굴 없는 모델 생성 문제 (Mannequin Issue)
- **문제**: 의류 상품 이미지를 생성할 때, 사람이 착용한 모습이 아니라 마네킹이나 목이 잘린(Headless) 형태로 생성되는 문제가 지속됨.
- **원인**: AI가 상품 자체에 집중하려다 보니, 인간 모델을 "불필요한 배경 요소"로 인식하거나 안전 필터가 보수적으로 작동함.
- **수정**:
    - **Positive Semantic Prompts**: "Happy human model", "Fully visible face", "Smiling expression" 등 긍정적이고 구체적인 인물 묘사 키워드를 프롬프트 앞단에 배치.
    - **맥락 강화**: "Lifestyle photography", "Street fashion scan" 등 자연스러운 맥락을 부여.

### 2. 색상 플레이스홀더 치환 오류
- **문제**: 다중 색상 템플릿 사용 시, `{{COLOR_1}}`과 같은 플레이스홀더가 제대로 치환되지 않고 그대로 프롬프트에 남거나, 순서가 뒤섞임.
- **원인**: 템플릿 구조 적용(`applyTemplateStructure`) 시점이 아니라 최종 프롬프트 생성 시점에서 치환하려고 하여, 문맥 정보가 유실됨.
- **수정**: `templateStructure`를 적용하는 단계에서 미리 색상 옵션(`colorOptions`)을 매핑하여 플레이스홀더를 실제 색상명으로 "Pre-substitute" 하도록 로직 변경.

---

## 📅 2025-12-29

### 1. Grid-1 결과 렌더링 오류
- **문제**: `grid-1` 레이아웃(세로 1열) 사용 시, 결과 페이지나 미리보기에서 이미지가 보이지 않음.
- **원인**: 그리드 시스템이 2열 이상만 상정하고 작성되어 있어, 1열일 때의 `map` 처리나 스타일링이 누락됨.
- **수정**: `grid-1` 케이스를 추가하고, 단일 이미지와 유사하지만 그리드 컨테이너 내에서 렌더링되도록 수정.

### 2. 이미지 저장 시 CORS 오류
- **문제**: 생성된 기획안의 이미지를 Google Drive로 저장하려고 할 때 Cross-Origin Resource Sharing(CORS) 에러 발생.
- **수정**: Canvas를 사용하여 이미지를 바이너리(Blob)로 변환하는 과정에서 `crossOrigin = 'anonymous'` 속성을 설정하고, 프록시 서버 설정을 점검함.

---

## 📅 2025-12-27

### 1. 이미지 크롭 좌표계 불일치
- **문제**: 사용자가 미리보기에서 설정한 크롭 영역(Zoom/Pan)과 실제 결과물(HTML)에 적용된 크롭 영역이 서로 다름.
- **원인**: 미리보기 캔버스의 좌표계(Scale)와 실제 CSS `transform` 적용 시의 기준점(Origin)이 달랐음.
- **수정**: `react-easy-crop`의 결과값(x, y, zoom)을 CSS `transform: translate(x, y) scale(zoom)`으로 변환하는 수식을 통일하고, 뷰포트 기준을 퍼센트(%)로 변환하여 저장.

---

## 📅 2025-12-26

### 1. 플로팅 바로 인한 콘텐츠 가림
- **문제**: 하단에 고정된 플로팅 액션 바(높이 약 80px)가 페이지 최하단의 콘텐츠(저장 버튼 등)를 가려서 클릭할 수 없음.
- **수정**: 메인 컨테이너(`App` 또는 `Step` 래퍼) 하단에 `padding-bottom: 120px` (플로팅 바 높이 + 여유 공간)을 추가하여 스크롤 영역을 확보함.

### 2. Text-Only 섹션에서 불필요한 이미지 생성
- **문제**: 텍스트만 있는 섹션(`text-only`)인데도 AI가 이미지를 생성하려고 시도하여 시간과 리소스를 낭비함.
- **수정**: `generateImage` 로직에 진입하기 전, `layoutType === 'text-only'`인지 확인하는 가드 절(Guard Clause)을 추가하여 이미지 생성을 원천 차단.

### 3. 새 섹션 추가 시 고정 이미지 누락
- **문제**: 사용자가 "섹션 추가"를 통해 직접 추가한 섹션에 고정 이미지(아이콘 등)를 설정하고 저장했으나, 최종 결과 페이지에는 이미지가 뜨지 않음.
- **원인**: 새로 추가된 섹션의 `fixedImageBase64` 데이터가 상태 관리(`Context` 또는 `State`)에 올바르게 병합되지 않고 휘발됨.
- **수정**: 섹션 추가/수정 리듀서(Reducer)에서 고정 이미지 데이터 필드를 누락 없이 복사하도록 수정.

---

## 📅 2025-12-25

### 1. 결과 페이지 그리드 이미지 누락
- **문제**: Step 3(생성)에서는 그리드 이미지가 잘 보였으나, Step 4(결과) 페이지에서는 해당 이미지가 엑박(Broken Image)으로 표시됨.
- **원인**: 그리드 슬롯의 이미지 데이터가 `sections` 배열 내부의 `imageSlots` 속성에 있는데, 결과 페이지 렌더러는 기존 `imageUrl` 속성만 참조하고 있었음.
- **수정**: 결과 페이지 렌더러(`StepResult.tsx`)가 `imageSlots` 배열을 우선 확인하고, 있으면 그리드 형태로 렌더링하도록 로직 개선.

---

## 📅 2025-12-19

### 1. Mode C 타임아웃 문제
- **문제**: 이미지 수정(텍스트 지우기 등) 작업이 30초 이상 걸리면서 브라우저나 프록시에서 타임아웃 에러 발생.
- **원인**: Cloud Functions 또는 GAS의 기본 타임아웃 제한에 걸림.
- **수정**: 타임아웃 설정을 5분(300,000ms)으로 대폭 상향하고, 백엔드 처리 로직을 비동기 구조로 개선함.

### 2. GAS CORS 오류
- **문제**: Google Apps Script 웹 앱 호출 시 `No 'Access-Control-Allow-Origin' header` 에러 발생.
- **원인**: GAS는 오류 발생 시 CORS 헤더 없이 HTML 에러 페이지를 리턴하는 특성이 있음. 또는 `doPost` 함수가 리턴하는 `ContentService` 객체에 MIME 타입 설정이 누락됨.
- **수정**: GAS 코드 내 `doPost` 리턴 시 `setMimeType(ContentService.MimeType.JSON)`을 명시하고, 클라이언트에서는 `mode: 'no-cors'` 대신 에러 핸들링을 강화하여 불투명한 응답(Opaque Response) 문제를 우회함.
